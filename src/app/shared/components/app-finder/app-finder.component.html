<div class="relative xl:w-4xl xl:block xl:mx-auto" (click)="onCloseDropdown()">
<!-- Search Engine Selector -->
  <button
    class="absolute z-10 top-4.5 left-4 flex items-center gap-2 text-white/70 hover:text-white transition-colors cursor-pointer group"
    aria-label="Select search engine"
    aria-haspopup="listbox"
    [attr.aria-expanded]="isEngineDropdownOpen()"
    (click)="onToggleEngineDropdown($event)"
  >
    @if (currentEngine()) {
      <ng-icon
        class="text-lg transition-transform"
        [class.text-white]="isEngineDropdownOpen()"
        [name]="currentEngine()!.icon"
      />
    } @else {
      <ng-icon class="text-2xl opacity-50 relative bottom-1" name="heroMagnifyingGlass" />
    }
  </button>

  <!-- Engine Dropdown -->
  @if (availableEngines().length > 0 && isEngineDropdownOpen()) {
    <ul
      class="absolute z-20 top-full left-4 mt-2 bg-white/95 text-black backdrop-blur-md border border-white/30 rounded-2xl shadow-2xl py-2 min-w-48"
      role="listbox"
      aria-label="Search engines"
    >
      @if (currentEngine()) {
        <li
          class="px-4 py-2 cursor-pointer transition-colors hover:bg-black/5 flex items-center gap-2"
          role="option"
          (click)="onSelectEngine()"
        >
          <ng-icon name="heroMagnifyingGlass" />
          <span class="text-gray-700">Search on your apps</span>
        </li>
      }

      @for (engine of availableEngines(); track engine?.id) {
        @if (currentEngine()?.id !== engine?.id) {
          <li
            class="px-4 py-2 cursor-pointer transition-colors hover:bg-black/5 flex items-center gap-2"
            role="option"
            [attr.aria-selected]="currentEngine()?.id === engine?.id"
            (click)="onSelectEngine(engine)"
          >
            <ng-icon [name]="engine?.icon" />
            <span class="text-gray-700">{{ engine?.name }}</span>
          </li>
        }
      }
    </ul>
  }

  <input
    type="search"
    class="bg-white/10 backdrop-blur-md border border-white/20 rounded-4xl xl:w-4xl xl:block xl:mx-auto px-12 py-3 mb-6 text-xl text-white placeholder-white/50 focus:bg-white/15 focus:border-white/40 focus:outline-none focus:ring-2 focus:ring-white/20 w-full transition-all duration-300"
    [placeholder]="inputPlaceholder"
    [value]="searchQuery()"
    (input)="onSearchInput($event)"
    (keyup.enter)="onSearchEnter()"
    aria-label="Search applications"
  />

  @if (haveSearch()) {
    <ng-icon
      class="absolute z-10 top-3.5 right-4 text-2xl opacity-50 cursor-pointer hover:opacity-70 transition-opacity"
      name="heroXMark"
      (click)="onHandleResetSearch()"
      aria-label="Clear search"
    />
  }
</div>
